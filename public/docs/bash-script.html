<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-08-27T19:15:59.2016317"><title>Deployment preparation | Inventory System Docs</title><script type="application/json" id="virtual-toc-data">[{"id":"1-script-skeleton","level":0,"title":"1. Script skeleton","anchor":"#1-script-skeleton"},{"id":"2-automate-env-cleanup","level":0,"title":"2. Automate .env cleanup","anchor":"#2-automate-env-cleanup"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b408/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Deployment preparation | Inventory System Docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Inventory System Docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/bash-script.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Deployment preparation | Inventory System Docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/bash-script.html#webpage",
    "url": "writerside-documentation/bash-script.html",
    "name": "Deployment preparation | Inventory System Docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Inventory System Docs Help"
}</script><!-- End Schema.org --></head><body data-id="Bash-script" data-main-title="Deployment preparation" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Inventory System Docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Bash-script" id="Bash-script.md">Deployment preparation</h1><aside class="prompt" data-type="tip" data-title="" id="z2bafv4_3"><p id="z2bafv4_6">Often you don't want to deploy all dev files directly to server. <br> That's why we want to &quot;pack up&quot; our project before deploying it</p></aside><section class="chapter"><h2 id="1-script-skeleton" data-toc="1-script-skeleton">1. Script skeleton</h2><ul class="list _bullet" id="z2bafv4_8"><li class="list__item" id="z2bafv4_20"><p>First, decide where you want to put your build script, usually that would be <code class="code" id="z2bafv4_24">bin/</code> dir</p></li><li class="list__item" id="z2bafv4_21"><p>Name your script however you like, I will go with <code class="code" id="z2bafv4_25">build.sh</code></p></li><li class="list__item" id="z2bafv4_22"><p>Now decide where you want to store deploy build, I am fine with project root</p></li><li class="list__item" id="z2bafv4_23"><p>Declare a file type</p></li></ul><div class="code-block" data-lang="bash">
#!/bin/bash
</div><aside class="prompt" data-type="tip" data-title="" id="z2bafv4_10"><p id="z2bafv4_26">Optional is to wrap a whole script in timer, so you can see exec time</p></aside><div class="code-block" data-lang="bash">
#!/bin/bash

start=$(date +%s)
    #your script here
end=$(date +%s)

echo &quot;Build done in $((end-start)) seconds&quot;
echo 'Project is ready for deployment'
</div><ul class="list _bullet" id="z2bafv4_12"><li class="list__item" id="z2bafv4_27"><p>Now it's time to define destination dir and create it</p></li></ul><div class="code-block" data-lang="bash">
#!/bin/bash

start=$(date +%s)
DEST_DIR='build'
cd ../
mkdir -p &quot;$DEST_DIR&quot;
end=$(date +%s)

echo &quot;Build done in $((end-start)) seconds&quot;
echo 'Project is ready for deployment'
</div><ul class="list _bullet" id="z2bafv4_14"><li class="list__item" id="z2bafv4_28"><p>After creating the desired dir, we can copy over all necessary files for deployment</p></li></ul><div class="code-block" data-lang="bash">

cp -rpv app public src templates .env .htaccess composer.json composer.lock firebase.json &quot;$DEST_DIR/&quot;
cd &quot;$DEST_DIR/&quot; || exit

</div><ul class="list _bullet" id="z2bafv4_16"><li class="list__item" id="z2bafv4_29"><p>Now we need to install all dependencies with composer</p></li><li class="list__item" id="z2bafv4_30"><p>We can do it by running <code class="code" id="z2bafv4_31">composer install</code></p></li></ul><div class="code-block" data-lang="bash">

composer install --no-dev --prefer-dist --no-interaction --no-progress  --optimize-autoloader
composer dump-autoload --optimize

</div><ul class="list _bullet" id="z2bafv4_18"><li class="list__item" id="z2bafv4_32"><p>Along with the installation of all packages, we added some additional flags to optimized packages and generate class maps</p></li><li class="list__item" id="z2bafv4_33"><p>This is our final script</p></li></ul><div class="code-block" data-lang="bash">

start=$(date +%s)
DEST_DIR='build'
cd ../
mkdir -p &quot;$DEST_DIR&quot;

cp -rpv app public src templates .env .htaccess composer.json composer.lock firebase.json &quot;$DEST_DIR/&quot;
cd &quot;$DEST_DIR/&quot; || exit

composer install --no-dev --prefer-dist --no-interaction --no-progress  --optimize-autoloader
composer dump-autoload --optimize
end=$(date +%s)

echo &quot;Build done in $((end-start)) seconds&quot;
echo 'Project is ready for deployment'

</div></section><section class="chapter"><h2 id="2-automate-env-cleanup" data-toc="2-automate-env-cleanup">2. Automate .env cleanup</h2><ul class="list _bullet" id="z2bafv4_34"><li class="list__item" id="z2bafv4_41"><p>Now, our project is ready for deployment, but we can also automate <code class="code" id="z2bafv4_43">.env</code> changes that we will probably need to make to deploy the project</p></li><li class="list__item" id="z2bafv4_42"><p>For this, we will also need another bash file that VCS will ignore, and we will put all server variables</p></li></ul><div class="code-block" data-lang="bash">
#!/bin/bash
#build-vars.sh

ENV_DB_USER='DB_USER' # name of env variable
NEW_DB_USER='dbuser'  # new value of env var

ENV_DB_PASSWD='DB_PASSWORD'
NEW_DB_PASSWD='dbpass'

ENV_URL_FE='MAIN_URL_FE'
NEW_URL_FE='https://example-front.com'

ENV_URL_BE='MAIN_URL_BE'
NEW_URL_BE='https://example-back.com'

ENV_LOCAL_STORAGE_URL='LOCAL_STORAGE_URL'
NEW_LOCAL_STORAGE_URL='/home/user/public_html/public/'
</div><ul class="list _bullet" id="z2bafv4_36"><li class="list__item" id="z2bafv4_44"><p>Back to our build script, we can import those variables and swap them in our <code class="code" id="z2bafv4_45">.env</code> file</p></li></ul><div class="code-block" data-lang="bash">

source &quot;$(dirname &quot;$0&quot;)/build-vars.sh&quot;

sed -i &quot;s/^${ENV_DB_USER}=.*/${ENV_DB_USER}='$(printf '%s\n' &quot;$NEW_DB_USER&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_DB_PASSWD}=.*/${ENV_DB_PASSWD}='$(printf '%s\n' &quot;$NEW_DB_PASSWD&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_URL_FE}=.*/${ENV_URL_FE}='$(printf '%s\n' &quot;$NEW_URL_FE&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_URL_BE}=.*/${ENV_URL_BE}='$(printf '%s\n' &quot;$NEW_URL_BE&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_LOCAL_STORAGE_URL}=.*/${ENV_LOCAL_STORAGE_URL}='$(printf '%s\n' &quot;$NEW_LOCAL_STORAGE_URL&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env

</div><aside class="prompt" data-type="tip" data-title="" id="z2bafv4_38"><p id="z2bafv4_46">Env variables need to have the exact same name on both sides</p></aside><ul class="list _bullet" id="z2bafv4_39"><li class="list__item" id="z2bafv4_47"><p>Finally, this is our deployment script</p></li><li class="list__item" id="z2bafv4_48"><p>After running it, you can deploy your project, however, you like, FTP, SFTP, etc.</p></li></ul><div class="code-block" data-lang="bash">
#!/bin/bash

start=$(date +%s)

DEST_DIR='build'
cd ../
mkdir -p &quot;$DEST_DIR&quot;

cp -rpv app public src templates .env .htaccess composer.json composer.lock firebase.json &quot;$DEST_DIR/&quot;
cd &quot;$DEST_DIR/&quot; || exit

composer install --no-dev --prefer-dist --no-interaction --no-progress  --optimize-autoloader
composer dump-autoload --optimize

source &quot;$(dirname &quot;$0&quot;)/build-vars.sh&quot;

sed -i &quot;s/^${ENV_DB_USER}=.*/${ENV_DB_USER}='$(printf '%s\n' &quot;$NEW_DB_USER&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_DB_PASSWD}=.*/${ENV_DB_PASSWD}='$(printf '%s\n' &quot;$NEW_DB_PASSWD&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_URL_FE}=.*/${ENV_URL_FE}='$(printf '%s\n' &quot;$NEW_URL_FE&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_URL_BE}=.*/${ENV_URL_BE}='$(printf '%s\n' &quot;$NEW_URL_BE&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env
sed -i &quot;s/^${ENV_LOCAL_STORAGE_URL}=.*/${ENV_LOCAL_STORAGE_URL}='$(printf '%s\n' &quot;$NEW_LOCAL_STORAGE_URL&quot; | sed 's/[\/&amp;]/\&/g')'/&quot; ./.env

end=$(date +%s)

echo &quot;Build done in $((end-start)) seconds&quot;
echo 'Project is ready for deployment'

</div></section><div class="last-modified">Last modified: 27 avgust 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="serving-swagger-php-from-slim.html" class="navigation-links__prev">Serving Swagger-PHP from Slim</a><a href="phpunit.html" class="navigation-links__next">PHPUnit</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b408/app.js"></script></body></html>